@model FutureTechnologyE_Commerce.Models.CartViewModel
@{
    ViewData["Title"] = "Checkout";
}

<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-12 col-md-10 col-lg-8">
            <div class="card shadow-lg border-0 rounded-4 overflow-hidden">
                <!-- Card Header -->
                <div class="card-header bg-primary text-white py-4">
                    <h3 class="mb-0 fw-bold text-center">Checkout</h3>
                </div>

                <!-- Form Body -->
                <div class="card-body p-4 p-md-5">
                    <form method="post" asp-controller="Checkout" asp-action="Index" class="needs-validation" novalidate>
                        <div asp-validation-summary="All" class="text-danger mb-3"></div>
                        
                        <!-- Info Alert -->
                        <div class="alert alert-info mb-4" role="alert">
                            <i class="bi bi-info-circle-fill me-2"></i>
                            Please enter your shipping information below. All fields marked with * are required.
                        </div>
                        
                        <!-- Hidden Fields for Data Preservation -->
                        <input type="hidden" asp-for="OrderHeader.ApplicationUserId" />
                        <input type="hidden" asp-for="OrderHeader.OrderTotal" />
                        <input type="hidden" asp-for="OrderHeader.OrderDate" />

                        <!-- Personal Information -->
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label asp-for="OrderHeader.first_name" class="form-label fw-bold text-capitalize"></label>
                                <input asp-for="OrderHeader.first_name" class="form-control form-control-lg" placeholder="Enter first name" required>
                                <span asp-validation-for="OrderHeader.first_name" class="text-danger"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="OrderHeader.last_name" class="form-label fw-bold text-capitalize"></label>
                                <input asp-for="OrderHeader.last_name" class="form-control form-control-lg" placeholder="Enter last name" required>
                                <span asp-validation-for="OrderHeader.last_name" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- Contact Information -->
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label asp-for="OrderHeader.email" class="form-label fw-bold text-capitalize"></label>
                                <input asp-for="OrderHeader.email" type="email" class="form-control form-control-lg" placeholder="Enter email address" required>
                                <span asp-validation-for="OrderHeader.email" class="text-danger"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="OrderHeader.phone_number" class="form-label fw-bold text-capitalize"></label>
                                <input asp-for="OrderHeader.phone_number" class="form-control form-control-lg" placeholder="Enter phone number" required>
                                <span asp-validation-for="OrderHeader.phone_number" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- Address Information -->
                        <div class="row g-3 mb-4">
                            <div class="col-12">
                                <label asp-for="OrderHeader.street" class="form-label fw-bold text-capitalize"></label>
                                <input asp-for="OrderHeader.street" class="form-control form-control-lg" placeholder="Enter street address" required>
                                <span asp-validation-for="OrderHeader.street" class="text-danger"></span>
                            </div>
                            <div class="col-md-3">
                                <label asp-for="OrderHeader.building" class="form-label fw-bold text-capitalize"></label>
                                <input asp-for="OrderHeader.building" class="form-control form-control-lg" placeholder="Building number/name">
                                <span asp-validation-for="OrderHeader.building" class="text-danger"></span>
                            </div>
                            <div class="col-md-3">
                                <label asp-for="OrderHeader.apartment" class="form-label fw-bold text-capitalize"></label>
                                <input asp-for="OrderHeader.apartment" class="form-control form-control-lg" placeholder="Apartment number">
                                <span asp-validation-for="OrderHeader.apartment" class="text-danger"></span>
                            </div>
                            <div class="col-md-3">
                                <label asp-for="OrderHeader.floor" class="form-label fw-bold text-capitalize"></label>
                                <input asp-for="OrderHeader.floor" class="form-control form-control-lg" placeholder="Floor number">
                                <span asp-validation-for="OrderHeader.floor" class="text-danger"></span>
                            </div>
                            <div class="col-md-3">
                                <label asp-for="OrderHeader.state" class="form-label fw-bold text-capitalize"></label>
                                <input asp-for="OrderHeader.state" class="form-control form-control-lg" placeholder="Enter state/city" required>
                                <span asp-validation-for="OrderHeader.state" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- Payment Method Selection -->
                        <div class="mb-4">
                            <h5 class="mb-3 fw-bold text-capitalize">Payment Method</h5>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" asp-for="SelectedPaymentMethod" id="paymentMethodOnline" value="@FutureTechnologyE_Commerce.Utility.SD.Payment_Method_Online" checked>
                                <label class="form-check-label d-flex align-items-center" for="paymentMethodOnline">
                                    <i class="bi bi-credit-card-2-front me-2 fs-5"></i>
                                    <span>Credit/Debit Card (Online Payment)</span>
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" asp-for="SelectedPaymentMethod" id="paymentMethodCOD" value="@FutureTechnologyE_Commerce.Utility.SD.Payment_Method_COD">
                                <label class="form-check-label d-flex align-items-center" for="paymentMethodCOD">
                                    <i class="bi bi-cash-coin me-2 fs-5"></i>
                                    <span>Cash on Delivery (COD)</span>
                                </label>
                            </div>
                        </div>

                        <!-- Order Summary -->
                        <div class="card rounded-3 border-0 shadow-sm mb-4">
                            <div class="card-body p-4">
                                <h5 class="mb-3 fw-bold text-capitalize">Order Summary</h5>
                                <!-- Order Items -->
                                <div class="mb-3">
                                    @foreach (var item in Model.CartList)
                                    {
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>@item.Product.Name x @item.Count</span>
                                            <span>@((item.price * item.Count).ToString("C"))</span>
                                        </div>
                                    }
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Subtotal</span>
                                    <span>@Model.OrderHeader.OrderTotal.ToString("C")</span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Shipping</span>
                                    <span>Free</span>
                                </div>
                                <hr class="my-3">
                                <div class="d-flex justify-content-between fw-bold text-capitalize">
                                    <span>Total</span>
                                    <span>@Model.OrderHeader.OrderTotal.ToString("C")</span>
                                </div>
                            </div>
                        </div>

                        <!-- Update Shipping Details -->
                        <div class="d-flex justify-content-between mb-3">
                            <a asp-controller="Cart" asp-action="Index" class="btn btn-outline-secondary">
                                <i class="bi bi-arrow-left me-2"></i> Back to Cart
                            </a>
                            
                            <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#updateShippingModal">
                                <i class="bi bi-pencil me-2"></i> Update Shipping Details
                            </button>
                        </div>

                        <!-- Submit Button -->
                        <div class="d-grid">
                            <button type="submit" id="submitOrderBtn" class="btn btn-lg btn-primary rounded-pill py-3">
                                <i class="bi bi-lock-fill me-2"></i> Place Order with Card Payment
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Update Shipping Details Modal -->
<div class="modal fade" id="updateShippingModal" tabindex="-1" aria-labelledby="updateShippingModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="updateShippingModalLabel">Update Shipping Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" asp-controller="Checkout" asp-action="UpdateShippingDetails" class="needs-validation" novalidate>
                <div class="modal-body">
                    <!-- Hidden Fields for Data Preservation -->
                    <input type="hidden" asp-for="OrderHeader.ApplicationUserId" />
                    <input type="hidden" asp-for="OrderHeader.OrderTotal" />
                    <input type="hidden" asp-for="OrderHeader.OrderDate" />
                    <input type="hidden" asp-for="OrderHeader.PaymentMethod" />
                    <input type="hidden" asp-for="SelectedPaymentMethod" />
                    
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label asp-for="OrderHeader.first_name" class="form-label fw-bold text-capitalize"></label>
                            <input asp-for="OrderHeader.first_name" class="form-control" placeholder="Enter first name" required>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="OrderHeader.last_name" class="form-label fw-bold text-capitalize"></label>
                            <input asp-for="OrderHeader.last_name" class="form-control" placeholder="Enter last name" required>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="OrderHeader.phone_number" class="form-label fw-bold text-capitalize"></label>
                            <input asp-for="OrderHeader.phone_number" class="form-control" placeholder="Enter phone number" required>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="OrderHeader.state" class="form-label fw-bold text-capitalize"></label>
                            <input asp-for="OrderHeader.state" class="form-control" placeholder="Enter state/city" required>
                        </div>
                        <div class="col-12">
                            <label asp-for="OrderHeader.email" class="form-label fw-bold text-capitalize"></label>
                            <input asp-for="OrderHeader.email" type="email" class="form-control" placeholder="Enter email address" required>
                        </div>
                        <div class="col-12">
                            <label asp-for="OrderHeader.street" class="form-label fw-bold text-capitalize"></label>
                            <input asp-for="OrderHeader.street" class="form-control" placeholder="Enter street address" required>
                        </div>
                        <div class="col-md-4">
                            <label asp-for="OrderHeader.building" class="form-label fw-bold text-capitalize"></label>
                            <input asp-for="OrderHeader.building" class="form-control" placeholder="Building number/name">
                        </div>
                        <div class="col-md-4">
                            <label asp-for="OrderHeader.apartment" class="form-label fw-bold text-capitalize"></label>
                            <input asp-for="OrderHeader.apartment" class="form-control" placeholder="Apartment number">
                        </div>
                        <div class="col-md-4">
                            <label asp-for="OrderHeader.floor" class="form-label fw-bold text-capitalize"></label>
                            <input asp-for="OrderHeader.floor" class="form-control" placeholder="Floor number">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    /* Card styling */
    .card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    @@media (max-width: 768px) {
        .card-header {
            border-bottom: none;
        }

        .form-control-lg {
            font-size: 1rem;
            padding: 0.75rem;
        }
    }

    /* Handle placeholders across all browsers */
    /* Chrome, Firefox, Opera, Safari 10.1+ */
    .form-control-lg::placeholder {
        color: rgba(0, 0, 0, 0.15) !important;
        opacity: 1 !important; /* Firefox */
        transition: opacity 0.1s ease;
    }
    
    /* Internet Explorer 10-11 */
    .form-control-lg:-ms-input-placeholder {
        color: rgba(0, 0, 0, 0.15) !important;
        transition: opacity 0.1s ease;
    }
    
    /* Microsoft Edge */
    .form-control-lg::-ms-input-placeholder {
        color: rgba(0, 0, 0, 0.15) !important;
        transition: opacity 0.1s ease;
    }
    
    /* Hide on focus - all browsers */
    .form-control-lg:focus::placeholder {
        opacity: 0 !important;
    }
    
    .form-control-lg:focus:-ms-input-placeholder {
        opacity: 0 !important;
    }
    
    .form-control-lg:focus::-ms-input-placeholder {
        opacity: 0 !important;
    }

    /* Ensure labels stay bold */
    .form-label {
        font-weight: 600 !important;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Get all form inputs with placeholders
        const inputs = document.querySelectorAll('.form-control-lg[placeholder]');
        
        // Make placeholders semi-transparent
        inputs.forEach(input => {
            // Set initial placeholder color to be very light
            input.style.color = 'black'; // Ensure text is black
            
            // When input gets focus, remove placeholder
            input.addEventListener('focus', function() {
                if (this.placeholder) {
                    this.dataset.placeholder = this.placeholder; // Store original
                    this.placeholder = ''; // Remove placeholder
                }
            });
            
            // When input loses focus, restore placeholder if empty
            input.addEventListener('blur', function() {
                if (this.value === '' && this.dataset.placeholder) {
                    this.placeholder = this.dataset.placeholder;
                }
            });
            
            // When typing starts, keep placeholder hidden
            input.addEventListener('input', function() {
                if (this.value !== '') {
                    this.placeholder = '';
                }
            });
        });
        
        // Handle payment method selection
        const paymentMethodOnline = document.getElementById('paymentMethodOnline');
        const paymentMethodCOD = document.getElementById('paymentMethodCOD');
        const submitOrderBtn = document.getElementById('submitOrderBtn');
        
        function updateButtonText() {
            if (paymentMethodOnline.checked) {
                submitOrderBtn.innerHTML = '<i class="bi bi-lock-fill me-2"></i> Place Order with Card Payment';
            } else if (paymentMethodCOD.checked) {
                submitOrderBtn.innerHTML = '<i class="bi bi-cash-coin me-2"></i> Place Order with Cash on Delivery';
            }
        }
        
        // Initial setup
        updateButtonText();
        
        // Add event listeners to radio buttons
        paymentMethodOnline.addEventListener('change', updateButtonText);
        paymentMethodCOD.addEventListener('change', updateButtonText);
    });
</script>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}