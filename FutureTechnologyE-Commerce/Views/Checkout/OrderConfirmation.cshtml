@model FutureTechnologyE_Commerce.Models.ViewModels.OrderDetailsViewModel
@using FutureTechnologyE_Commerce.Utility
@{
    ViewData["Title"] = "Order Confirmation";
}

<div class="container py-5">
    <div class="row mb-4">
        <div class="col-md-12 text-center">
            <i class="bi bi-check-circle-fill text-success" style="font-size: 3rem;"></i>
            <h1 class="mt-3">Thank You for Your Order!</h1>
            <p class="lead">Your order has been confirmed and is being processed.</p>
            
            @if (TempData["PaymentSuccess"] != null)
            {
                var success = (bool)TempData["PaymentSuccess"];
                var message = TempData["PaymentMessage"]?.ToString();
                var transactionId = TempData["TransactionId"]?.ToString();
                
                <div class="alert @(success ? "alert-success" : "alert-danger") mt-3">
                    <h5><i class="bi @(success ? "bi-check-circle" : "bi-exclamation-circle")"></i> @message</h5>
                    @if (!string.IsNullOrEmpty(transactionId) && transactionId != "N/A")
                    {
                        <p class="mb-0">Transaction ID: @transactionId</p>
                    }
                </div>
            }
            
            @if (TempData["PaymentError"] != null)
            {
                <div class="alert alert-warning mt-3">
                    <p>@TempData["PaymentError"]</p>
                </div>
            }
        </div>
    </div>

    <div class="row">
        <div class="col-md-8 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Order #@Model.OrderHeader.Id</h5>
                </div>
                <div class="card-body p-4">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <h6>Order Status</h6>
                            <span class="badge bg-@(Model.OrderHeader.OrderStatus == SD.Status_Approved ? "success" : 
                                                   Model.OrderHeader.OrderStatus == SD.Status_Pending ? "warning" : 
                                                   Model.OrderHeader.OrderStatus == SD.Status_Cancelled ? "danger" : "info")">
                                @Model.OrderHeader.OrderStatus
                            </span>
                        </div>
                        <div class="col-md-6">
                            <h6>Payment Status</h6>
                            <span class="badge bg-@(Model.OrderHeader.PaymentStatus == SD.Payment_Status_Approved ? "success" : 
                                                   Model.OrderHeader.PaymentStatus == SD.Payment_Status_Pending ? "warning" : 
                                                   Model.OrderHeader.PaymentStatus == SD.Payment_Status_Rejected ? "danger" : "info")">
                                @Model.OrderHeader.PaymentStatus
                            </span>
                        </div>
                    </div>
                    
                    <h6>Shipping Address</h6>
                    <address>
                        @Model.OrderHeader.first_name @Model.OrderHeader.last_name<br>
                        @Model.OrderHeader.street<br>
                        @(string.IsNullOrEmpty(Model.OrderHeader.building) ? "" : $"Building {Model.OrderHeader.building}, ")<br>
                        @(string.IsNullOrEmpty(Model.OrderHeader.floor) ? "" : $"Floor {Model.OrderHeader.floor}<br>")
                        @Model.OrderHeader.state<br>
                        @Model.OrderHeader.phone_number<br>
                        @Model.OrderHeader.email
                    </address>
                </div>
            </div>
        </div>
        
        <div class="col-md-4 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Order Information</h5>
                </div>
                <div class="card-body p-4">
                    <p><strong>Order Date:</strong> @Model.OrderHeader.OrderDate.ToString("MMM dd, yyyy")</p>
                    <p><strong>Payment Method:</strong> @Model.OrderHeader.PaymentMethod</p>
                    <p><strong>Expected Delivery:</strong> @Model.OrderHeader.OrderDate.AddDays(5).ToString("MMM dd, yyyy")</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Products</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th style="width: 60px;"></th>
                                    <th>Product</th>
                                    <th class="text-center">Quantity</th>
                                    <th class="text-end">Price</th>
                                    <th class="text-end">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model.OrderDetails)
                                {
                                    <tr>
                                        <td>
                                            <img src="@(item.Product.ImageUrl ?? "/images/product-placeholder.jpg")" 
                                                 class="img-fluid" style="max-width: 50px;" 
                                                 alt="@item.Product.Name" />
                                        </td>
                                        <td>
                                            <h6 class="mb-0">@item.Product.Name</h6>
                                            <small class="text-muted">@(item.Product.Brand?.Name ?? "Brand not specified")</small>
                                        </td>
                                        <td class="text-center">@item.Count</td>
                                        <td class="text-end">EGP @item.Price.ToString("0.00")</td>
                                        <td class="text-end">EGP @((item.Count * item.Price).ToString("0.00"))</td>
                                    </tr>
                                }
                            </tbody>
                            <tfoot class="table-light">
                                <tr>
                                    <td colspan="4" class="text-end"><strong>Subtotal:</strong></td>
                                    <td class="text-end">EGP @Model.OrderHeader.OrderTotal.ToString("0.00")</td>
                                </tr>
                                <tr>
                                    <td colspan="4" class="text-end"><strong>Shipping:</strong></td>
                                    <td class="text-end">Free</td>
                                </tr>
                                <tr>
                                    <td colspan="4" class="text-end"><strong>Total:</strong></td>
                                    <td class="text-end"><strong>EGP @Model.OrderHeader.OrderTotal.ToString("0.00")</strong></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12 text-center">
            <div class="btn-group">
                <a href="@Url.Action("Index", "Home")" class="btn btn-outline-primary">
                    <i class="bi bi-cart"></i> Continue Shopping
                </a>
                <a href="@Url.Action("Details", "Order", new { id = Model.OrderHeader.Id })" class="btn btn-primary">
                    <i class="bi bi-receipt"></i> View Order Details
                </a>
            </div>
        </div>
    </div>
</div>

<style>
    /* Card styling */
    .card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    
    @@media (max-width: 768px) {
        .card-header {
            border-bottom: none;
        }
    }
    
    /* Animation for success message */
    @@keyframes fadeInDown {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .card-header {
        animation: fadeInDown 0.5s ease-out;
    }
</style> 